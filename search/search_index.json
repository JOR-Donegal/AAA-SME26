{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":"<p>AAA for an SME</p> <p>On any Greenfield site my starting point would be to build the core services. In almost every case these will be built around Active Directory. Beware Microsoft is trying to push customers in the direction of their public cloud, Azure. Note that anything I do using Microsoft technology, I could replicate, license free, using Linux.</p> <p>I am trying to achieve authentication, authorization and accounting (AAA). By far and ahead the most common solution for this in Ireland will be Microsoft's Active Directory (AD).</p> <p>In these exercises I am going work my way through from my first questions to my customer, to a good working prototype which can be deployed in a private cloud environment. Note that I will take a similar approach in Public Cloud. I'm going to start with a table of data that I need my client to populate with the minimal information I need to set up the systems.</p> Requirement Data Internet Domain electric-petrol.ie Local site Head Office Address range 10.0.0.0/16 <p>I am going to need some other details, in particular assignment of VLANs, hosts and servers. </p>"},{"location":"#customers-requirements","title":"Customer's requirements","text":"<p>This build is for a single site.  </p> <p>The customer does not have experienced full-time staff so they are very nervous with regard to system security. To assure the customer, we have agreed that there will be no internet or off-site connectivity whatsoever. We also need to build the site with resilience and high availability by default. We are going to have to have some sort of local solution for backup and recovery. And whatever solution we design will need to be as simple as possible.</p>"},{"location":"#proposed-solution","title":"Proposed solution","text":"<p>To meet these requirements, we will build a private cloud solution. There will be two hosts servers, each running a hypervisor. Each host will have Whatever servers are required for the customer's solution. And each of these hosts will maintain a copy of the service on the other host. The host servers themselves should be based on high availability hardware.</p>"},{"location":"a/","title":"L2/L3 Network Plan","text":"<p>I am going to follow general good practice and use VLANs to enforce application seperation and enhance security.</p> <ul> <li>I will configure IPv4 only to begin, but I will keep the same design pattern for IPv6.</li> <li>I will not use VLAN1, security best practice.</li> <li>I will group VLANs in groups of 16 for now as a best guess, the first group of VLANs will be reserved for infrastructure.</li> <li>Each VLAN will be /24.</li> <li>I will have at least 3 routers to each VLAN using router redundancy (HSRP/VRRP). .1, .2, .3</li> <li>The shared gateway address for these routers will be .20 in every VLAN.</li> <li>I will use .21-.99 in each VLAN for statics.</li> <li>I will use .100-.199 in each VLAN for DHCP. In practice, this implies 100 nodes per VLAN as a design specification.</li> <li>I will reserve addresses over .200 in each VLAN. This will give me some headroom if I run out of addresses!</li> </ul> <p>The table blow summarizes the VLANs I will create.</p> VLAN Purpose Subnet 1 Unused 2 Hosts 10.0.2.0/24 5 Clients (technicians) 10.0.5.0/24 6 Services 10.0.6.0/24 <p>Each host and server will have a fixed IP address, and it will use the same last octet in any VLAN.</p> <ul> <li>Hosts will be in the range .21-30</li> <li>Domain Controllers in the range .31-.40</li> <li>Storage in the range .41-.50</li> <li>Database servers in the range .51-.60</li> <li>Application servers in the range .61-.70</li> </ul>"},{"location":"b/","title":"Hosts","text":"<p>I am going to keep this really simple.  I will need two high availability servers and I will locate tham as far apart as possible, in the most secure/safe locations I can find on site. I plan for a hardware lifetime of five years.</p> <p>In my notes below, big B means Bytes, little b means bits!</p>"},{"location":"b/#processor","title":"Processor","text":"<p>Nothing about this project seems to demand high processing power,  but it will use virtualization. I would probably order a two processor system where each processor has at least eight cores.</p>"},{"location":"b/#primary-memory","title":"Primary memory","text":"<p>Each server will run a standard hypervisor; I'm going to allocate 64 gigabytes for that. To be generous, I'm going to allocate 64 gigabytes for each server type I will run. If I assume that each host will have a domain controller, a file server, a database server, and two application servers, I should estimate a minimum of 320GB of DRAM. I will specify 512GB. A modern server will probably have a capacity of &gt;1TB of DRAM. I am going to order the server with the largest DRAM sticks available. This will initially be more expensive, but it will allow me to upgrade over the servers lifetime, without throwing away expensive memory. I will be ordering registered, bufferred DRAM, I cover why in the theory notes on memory.</p>"},{"location":"b/#boot-partition","title":"Boot partition","text":"<p>Any modern server will have a boot-optimized storage system specifically for the hypervisor operating system. I'm normally going to specify two small NVMe drives for this.</p>"},{"location":"b/#main-storage","title":"Main Storage","text":"<p>There are three main considerations in any storage design. </p> <ul> <li>What capacity will be required over the lifetime of the system?</li> <li>What is the availability requirement?</li> <li>What is the performance requirement?</li> </ul> <p>We can estimate 50GB per VM operating system, but we will need information from the customer relating to the applications to estimate file and database storage requirement. For now, assume the customer has estimated no more than 1TB/year. Our estimate is now c. 6TB, we should design for 10TB.</p> <p>We will look at availability calculations later in this module. For now, let us specify a RAID controller and plan to use RAID6 only. Similarly, we will look at performance calculations later in the module. In this example, the required throughput would seem to fairly trivial, we will assume that the disk/controller combination will be sufficient. This would not be unusual on a small project. </p>"},{"location":"b/#beware","title":"Beware!!","text":"<p>There are issues using RAID controllers with Microsoft's Clustered Shared Storage technology on clusters. For this project, I am assumming we wil not use clusters. </p>"},{"location":"b/#networking","title":"Networking","text":"<p>Almost every server has two 1 Gb/s ports on its motherboard. We will use these for host management. These will normally connect to two separate Top of Rack (ToR) switches.</p> <p>There will be an out of band management device with a 1Gb/s connection. In a data center, there may be a dedicated management switch for this. On a small project like this, we will just connect it to one of the ToR switches.</p> <p>The host's purpose is to present servers and services for consumption by clients. We will normally provide two high speed connections, one to each ToR switch, and then use these for trunks or tagged traffic. These days, high speed means 10 to 100 Gb/s.</p> <p>The most demanding connections will be for back-end storage. We will look at this in more detail later in the module. There would be two high speed connections to a dedicated Back End (BE) switch. In this project, the customer has not specified any storage infrastructure, but we are going have to consider what that might be, in particular to allow backups. On a larger project, this might be quite complex and require us to use a specialized Host Bus Adapter (HBA). We will deal with Storage Area Networks later in this module.</p>"},{"location":"b/#other-characteristics","title":"Other characteristics","text":"<p>Any server we procure will have dual power supplies, hot pluggable.</p> <p>We will rack mount the server and ensure that there are two UPS devices close by.</p>"},{"location":"c/","title":"Servers (VMs)","text":"<p>I can build the virtual machine images for this project on any compatible host. In most cases I can sit at home and build them on my laptop. For simplicity I'm going to assume that my hosts are Windows Server 2025 DataCenter running hyper V. I'm going to assume that my VM's will all be Windows Server 2025 Standard.</p> <p>I will not build the hosts until I get to the customer site and I have the actual customer hardware. For now, I am going to build the virtual machines. Initially, I'll build the Gold images of a desktop and core instance of Windows Server. I will run through my checklist of things to do and seek guidance from whoever is advising the client on cybersecurity. Ideally, the customer provides precise guidelines for me, but this is normally not the case on an SME site. I might use this as an excuse to get the customer to write some policy documents and Standard Operating Procedures (SOPs).  Once the VMs are created, I will patch them up to date.</p>"},{"location":"c/#gold-images","title":"Gold Images","text":"<p>I now build and test </p> <ul> <li>w25-desktop</li> <li>w25-core</li> </ul>"},{"location":"c/#build-desktop-instance","title":"Build desktop instance","text":"<p>I am going to assume you can build Windows GUI instances, and that you build w25-desktop using the Windows Server 2025 Standard ISO. Make sure it is set to the correct time zone.</p>"},{"location":"c/#do-updates","title":"Do updates","text":"<p>Open PowerShell ISE as Administrator and run</p> <p><pre><code>Install-Module -Name PSWindowsUpdate\n</code></pre> You may be asked questions about installing other software. This is safe, go ahead.</p> <p>To see what updates are available,  <pre><code>Get-WindowsUpdate\n</code></pre></p> <p>I can install all of these using <pre><code>Get-WindowsUpdate -AcceptAll -Install -AutoReboot\n</code></pre> Shut down the VM and document it.</p>"},{"location":"c/#build-a-core-instance","title":"Build a Core instance","text":"<p>Go through the normal installation dialog but select Windows Server 2025 Standard</p> Fig 1. Install options. <ol> <li>On reboot, you will be required to set an administrator password.</li> <li>You may then be asked some standard questions.</li> <li>SConfig will load, which will allow you to do the initial configuration. </li> <li>Change the time zone and make sure the time is correct. </li> <li>Do updates (all quality updates) and reboot.</li> <li>Shut down the VM and document it.</li> </ol>"},{"location":"d/","title":"Configure DC1","text":"<p>I am using VMWare Worktation, adapt my instructions to whatever environment you are working in. I am going to use </p> <ol> <li>First, I create a full clone of my desktop image. I am the headoffice site, I will abbreviate that to HO.  My first domain controller will be dc1.ho.electric-petrol.ie</li> <li>I create a host-only network to match VLAN6.</li> <li>I power up dc1.</li> <li>I rename this VM, as it will still have the generic name of the gold image.</li> </ol> <pre><code># Name the first DC \nRename-Computer -NewName dc1\n</code></pre> <ol> <li>I give it a static IP address of 10.0.6.31/24. There is no gatway, but I'll use 10.0.6.20. First I find the interface ID</li> </ol> <pre><code># Check existing IP addresses &amp; interface ID\nGet-NetIPAddress\n</code></pre> <p>For me, if was InterfaceIndex 4</p> Fig 2. Get-NetIPAddress. <p>Now I set the correct IPv4 settings for dc1.</p> <p><pre><code>New-NetIPAddress -InterfaceIndex 4 -IPAddress 10.0.6.31 -PrefixLength 24 -DefaultGateway 10.0.6.20\n</code></pre> Finally, I reboot to make these settings current. <pre><code># Now reboot\nRestart-Computer\n</code></pre></p>"},{"location":"d/#install-features-for-a-new-forest","title":"Install features for a new forest","text":"<p>Now dc1 is ready for me to install active directory.  <pre><code># Set the forest name\n$FOREST = 'ho.electric-petrol.ie'\n# Install the required features\nInstall-WindowsFeature -name AD-Domain-Services -IncludeManagementTools\n# Create the root domain, all defaults except the domain name\nInstall-ADDSForest -DomainName $FOREST\n# Reboot\nShutdown /r /t 0\n</code></pre></p>"},{"location":"d/#_1","title":"Configure DC1","text":"<p>The system should now reboot. Using Server Manager, look through the standard tools for Active Directory to verify.</p>"},{"location":"d/#verify-and-configure-dhcp","title":"Verify and configure DHCP","text":"<p>We need to install DHCP and authorize it in AD. Check and verify as you go along, using the Server Manager plugin for DHCP. <pre><code># Install the feature\nInstall-WindowsFeature DHCP -IncludeManagementTools\n# Authorize in AD\nAdd-DhcpServerInDC -DnsName dc1.ho.electric-petrol.ie -IPAddress 10.0.6.31\n</code></pre> In DHCP, we normally set options for the entire server first, check the Server Options tab in the management tool. <pre><code>Set-DhcpServerv4OptionValue -DnsDomain ho.electric-petrol.ie\nSet-DhcpServerv4OptionValue -DnsServer 10.0.6.31\n</code></pre> Then we can set up individual scopes and any options that are particular to that scope. <pre><code>Add-DhcpServerv4Scope -name \"Clients\" -StartRange 10.0.5.100 -EndRange 10.0.5.199 -SubnetMask 255.255.255.0 -State Active\nAdd-DhcpServerv4ExclusionRange -ScopeID 10.0.5.0 -StartRange 10.0.5.0 -EndRange 10.0.5.99\n</code></pre></p>"},{"location":"d/#exercise","title":"Exercise","text":"<p>Set up the server LAN (VLAN6, 10.0.6.0/24) in an appropriate manner, we will need it later.</p>"},{"location":"d/#verify-and-configure-dns","title":"Verify and configure DNS","text":"<p>Verify that DNS was installed by default. Check and verify as you go along, using the Server Manager plugin for DNS. <pre><code># Make sure DNS was installed\nGet-WindowsFeature | where {($_.name -like \"DNS\")}\n</code></pre> Forward lookup zones are created by default, but we need to manually create the reverse lookup zones.</p> <pre><code>Add-DnsServerPrimaryZone -NetworkId 10.0.2.0/24 -ReplicationScope Domain\nAdd-DnsServerPrimaryZone -NetworkId 10.0.5.0/24 -ReplicationScope Domain\nAdd-DnsServerPrimaryZone -NetworkId 10.0.6.0/24 -ReplicationScope Domain\n</code></pre>"},{"location":"d/#functional-test","title":"Functional test","text":"<p>From the command prompt, do an nslookup against this server, for both forward and reverse lookup zones.</p>"},{"location":"d/#finally","title":"Finally","text":"<p>Loads done!</p> <p>As you go on, you will find that there are many other things you want to set. As you identify these, figure out the Power Shell for doing these tasks.</p>"},{"location":"e/","title":"Configure Active Directory","text":"<p>Microsoft is moving on from Server Manager, but for now, do these exercises in Server Manager.</p> <p>Under Tools, open the following plugins and configure</p>"},{"location":"e/#active-directory-sites-and-services","title":"Active Directory Sites and Services","text":"<ol> <li>Change the Default-First-Site-Name to an appropriate site name. For me, this is head office.</li> <li>Add the subnets appropriate for your site.</li> </ol> Fig 3. Configuring sites and subnets. <p>If HeadOffice had more than one physical site, we would document them with unique names here.</p> <p>For this simple project, we will leave inter-site transports as they are. In a complex project with multiple sites, we may define topologies here. Way too complicated for this exercise!</p>"},{"location":"e/#active-directory-domains-and-trusts","title":"Active Directory Domains and Trusts","text":"<p>This is a single domain and single site project. This is the simplest topology we can have but also the most common.</p> <p>Note that we can upgrade the AD database from here (raising functional level), something we rarly have to do.</p> <p>There is one FSMO role visible from here, the operations/naming master.</p> Fig 4. A FSMO role."},{"location":"e/#active-directory-users-and-computers","title":"Active Directory Users and Computers","text":"<p>I do not want to go into Group Policies in this module, but it is probably the most important single reason for the success of Active Directory. It would cost us at least a week of theory and practice and it's well off the theme of this module. It's based on the idea that we can build a hierarchical structure in Active Directory and apply policies at every level. A tool this powerful can be Incredibly destructive! For this reason we have some simple rules we apply.</p> <p>In the plugin we see a top level to the hierarchy, ho.electric-petrol.ie. We never want to set policies at this level, as they apply to the entire domain and I have seen technical staff locking out entire organizations by making an error at this level.</p> <p>Looking at the folders under this level, we see a difference in the symbol for domain controllers. This is a symbol for an organizational unit (OU). There is nothing special about a folder, but an OU allows policies to be applied to every object under that OU.</p> <p>Best practice is to create a top level OU at the highest level we might want to impose policies and then to build a structure underneath that; I called mine Head Office. This is not based on tidying up objects, thast is what folders are for! This structure is based on the levels at which you might want to apply distinct policies.</p> Fig 5. Organisational units. <p>## Finally  We have touched the surface here. </p> <p>To properly cover configuring Active Directory for a single site and domain would be the equivalent of a five-credit module at this level. We need to know this much about Active Directory so we can make things work in our hybrid cloud. We need AAA and the ability to do back authentication. We need DNS DHCP and a source of time. That is the very restricted scope of what I want to cover here.</p> <p>Later in this module, we will deal with complex multi domain configurations, but also in a curtailed way, concerned only with the structure of a complex AAA as we would require for a multi domain organization.</p>"},{"location":"f/","title":"Configure DC2","text":"<p>I created a Windows 2025 Core golden image earlier.  I clone that as dc2.ho.electric-petrol.ie and I'm going to configure it the easy way for now. Microsoft said they were going to deprecate the main tool we are going to use, but no sign of that yet.</p> <p>When you login, sconfig should auto run.</p> Fig 6. Sconfig. <ol> <li>Change the computer name to dc2</li> <li>Change the IP address to 10.0.6.32/24. If everything has worked correctly, it will already have a DHCP address from DC1.</li> <li>The DNS must point at DC1 (why?), 10.0.6.32.</li> <li>Now do a restart.</li> <li>Exit to the command line and ping 10.0.6.31, that will check connectivity.</li> <li>Ping dc1.ho.electric-petrol.ie, name resolution must work before we continue.</li> <li>Now run sconfig again.</li> <li>Join the domain ho.electric-petrol.ie</li> <li>Reboot</li> </ol> <p>I said I was going to do this the easy way. Now that the server DC2 is in the domain, I can do all control and configuration from DC1, which has a graphical user interface.</p> <p>In Server Manager I now add a server.</p> Fig 7. Server Manager. <p>I type DC2 and Find Now.</p> Fig 8. Adding a server. <p>I can now control DC2 as if it were the local server.</p> Fig 9. DC2 listed. <ol> <li>I right click DC2 and Add Roles and Features.</li> <li>I add Doamins Services, DHCP and DNS and I allow the server to restart if needed.</li> <li>I click Install</li> </ol> <p>After installation is complete, I need to promote DC2 to being a domain controller. By default, the wizard will try to add to the existing doamin and that is fine.</p> <ol> <li>Provide credentials when requested, the administrator account of the domain.</li> <li>Use the default site name HeadOffice and provide a DSRM password.</li> <li>Do not worry about the DNS delegation error!</li> <li>Use defaults for the rest of the settings, but save the script when you get the option, this is part of your documentation for the client.</li> </ol> <p>On the final screen, you will again get a delegation error, ignore this and click Install.</p> <p>After a few minutes you have a second DC&gt;</p>"},{"location":"f/#exercise","title":"Exercise","text":"<ol> <li>DNS is replicated and integrated into DNS, confirm DC2 is acting correctly as a DNS</li> <li>DHCP is unconfigured for now on DC2.</li> </ol>"}]}